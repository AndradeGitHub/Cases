USE [WM_DB]
GO

/****** Object:  StoredProcedure [dbo].[SP_WMDB_CARGA_CARTEIRA_BENCHMARK]    Script Date: 08/26/2013 14:15:38 ******/
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[SP_WMDB_CARGA_CARTEIRA_BENCHMARK]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[SP_WMDB_CARGA_CARTEIRA_BENCHMARK]
GO

USE [WM_DB]
GO

/****** Object:  StoredProcedure [dbo].[SP_WMDB_CARGA_CARTEIRA_BENCHMARK]    Script Date: 08/26/2013 14:15:38 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[SP_WMDB_CARGA_CARTEIRA_BENCHMARK]
As

Set Nocount On 

INSERT WM_DB.dbo.CARTEIRA_BENCHMARK 
(CD_CARTEIRA, CD_INDEX, NU_ORDEM)
SELECT CD_CARTEIRA, CD_INDEX, 1 
FROM WM_DB.dbo.CARTEIRA
WHERE CD_CARTEIRA NOT IN (SELECT CD_CARTEIRA FROM CARTEIRA_BENCHMARK )

UPDATE CARTEIRA_BENCHMARK 
	SET CD_INDEX = A.CD_INDEX
FROM CARTEIRA_BENCHMARK B
INNER JOIN WM_DB.dbo.CARTEIRA A
	ON A.CD_CARTEIRA = B.CD_CARTEIRA
GO

